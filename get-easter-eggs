import requests
from bs4 import BeautifulSoup
import time
from datetime import datetime

def scrape_aoc_current_year():    
    base_url = "https://adventofcode.com"
    year = datetime.now().year
    days = range(1, 13)
    
    print(f"Processing easter eggs")
    markdown_content = f"# {year}\n\n"
    
    for day in days:
        url = f"{base_url}/{year}/day/{day}"
        print(f"  Fetching day {day}...")
        
        try:
            # Add a small delay to be respectful to the server
            time.sleep(0.5)
            
            response = requests.get(url, timeout=10)
            response.raise_for_status()
            
            soup = BeautifulSoup(response.text, "html.parser")
            
            # Find all span elements with title attribute
            spans_with_title = soup.find_all("span", title=True)
            
            if spans_with_title:
                markdown_content += f"## Day {day}\n\n"
                
                for span in spans_with_title:
                    span_text = span.get_text(strip=True)
                    title_text = span["title"]
                    markdown_content += f"**{span_text}** : {title_text}\n\n"
            
        except requests.exceptions.RequestException as e:
            print(f"    Error fetching {url}: {e}")
            markdown_content += f"## Day {day}\n\n*Error fetching data*\n\n"
        except Exception as e:
            print(f"    Unexpected error on day {day}: {e}")
    
    if markdown_content is not None:
        with open("easter.eggs.md", "w", encoding="utf-8") as f:
            f.write(markdown_content)

if __name__ == "__main__":
    scrape_aoc_current_year()
